<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reporte preliminar :: SIGER</title>
        <link rel="stylesheet" href="styles/global.css">
        <link rel="stylesheet" href="styles/forms.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script>
            window.onload = function()
            {
                creaEtiquetas();
                creaHorarios();
                let btnAdd = document.getElementById('btnHorarios');
                btnAdd.onclick = creaHorarios;

                let btnDel = document.getElementById('btnElimina');
                btnDel.onclick=eliminaHorario;
            } 
        </script>
    <style>
        #etiquetas
        {
            display: flex;
            flex-direction: row;
        }

        #contBotones
        {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        textarea
        {
            resize:none;
        }

        .form-input {
                display: flex;
                padding: 1em;
                align-items: center;
            }

            .form-input > * {
                flex: 3;
            }

            .form-input > label {
                flex: 1;
            }

            .subject-picker {
                border: 1px solid var(--gray-border-color);
                width: 60%;
                margin: 1em auto;
            }

            .subject {
                display: flex;
                align-items: stretch;
                align-content: center;
                border-bottom: 1px solid var(--gray-border-color);
            }

            .subject > i {
                cursor: pointer;
                padding: 0.3em;
            }

            .subject > * {
                display: flex;
                align-items: center;
            }

            .subject > i:hover {
                color: white;
                background-color: rgb(179, 24, 24);
            }

            .subject > .subject-name {
                flex: 1;
            }

            .subject > .subject-key {
                font-weight: bold;
                margin: 0 1em;
            }
            
            .picker {
                display: flex;
            }

            .picker > select {
                flex: 1;
                border: none;
            }

            .picker > i {
                padding: 0.5em;
            }

            .button-container {
                display: flex;
                justify-content: center;
                margin-top: 2em;
            }

            .button-add-del
            {
                display: flex;
                justify-content: center;
                width: 6em;
                margin: 1em;
                /*margin-top: 2em;*/
            }
            
            .footer-iframe {
                overflow-y: visible;
            }

            #padre
            {
                display: flex;
                flex-direction: column;
            }

    </style>
</head>
<body>
    <!-- <button id="fixedbutton"><img src="assets/images/menu.png" onclick="openNav()"></button>
    
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a href="#"><img src="assets/images/reporte.png"> Reporte preliminar</a>
            <a href="#"><img src="assets/images/progreso.png"> Progreso actual</a>
            <a href="#"><img src="assets/images/brief.png"> Documentos</a>
            <a href="#"><img src="assets/images/chat.png"> Contacto con docentes</a>
        </div> -->

    <header class="header-extension">
        <div class="bar">
            <!-- <h1><a href="/home">SIGER</a></h1> -->
            <a href="/home" style="display: flex; flex-direction: row; align-items: center;">
                <img src="assets/images/siger-img.png" height="40px" alt="SIGER">
                <h1 style="margin-left: .5em;">SIGER</h1>
            </a>
            <h2>Reporte preliminar</h2>
        </div>
    </header>
    
    <div class="content">
        <form>
                <br>
                <h3>Descripción general del proyecto</h3>
                <div class="form-input">
                    <label for="">Nombre del proyecto</label>
                    <input type="text" name="txtNombreProyecto" id="txtNombreProyecto" autofocus required>
                </div>
                <div class="form-input">
                    <label for="">Objetivo general</label>
                    <textarea name="txtObjetivo" id="txtObjetivo" cols="30" rows="5" required></textarea>
                </div>
                <div class="form-input">
                    <label for="">Justificación (Problema a resolver):</label>
                    <textarea name="txtJustificacion" id="txtJustificacion" cols="30" rows="7" required></textarea>
                </div>
                <div class="form-input">
                    <label for="">Periodo de realización: </label>
                    <select name="selectPeriodo" id="selectPeriodo" required>
                        <option value="1">Enero-Junio</option>
                        <option value="2">Agosto-Diciembre</option>
                    </select>
                    <label for="">Año:</label>
                    <select name="selectYear" id="selectYear" required>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                    </select>
                </div>
            
            <!-------------------------------------------------------------------------->
            <div class="form-input">
                <label for="">Descripción de actividades:</label>
                <textarea name="txtActiviades" id="txtActividades" cols="30" rows="6" required></textarea>
            </div>
                <br>
                <h3>Información sobre la empresa, organismo o dependencia donde se desarrollará el proyecto.</h3>
                <div class="form-input">
                    <label for="">Nombre de la empresa: </label>
                    <input type="text" name="txtEmpresa" id="txtEmpresa" required>  
                </div>
                <div class="form-input">
                    <label for="">Representante legal de la empesa</label>
                    <input type="text" name="txtRepresentante" id="txtRepresentante" required>
                </div>
                <div class="form-input">
                    <label for="">Dirección: </label>
                    <input type="text" name="txtDirección" id="txtDireccion" required>
                    
                        <label for="">Teléfono:</label>
                        <input type="tel" name="txtTel" id="txtTel" required>
                        <label for="">Ciudad: </label>
                        <input type="text" name="txtCiudad" id="txtCiudad" required>
                    
                </div>
                <div class="form-input">
                    <label for="">Correo electrónico: </label>
                    <input
                        type="text"
                        placeholder="empresa@dominio.com"
                        name="emailEmpresa"
                        id="emailEmpresa"
                        
                    />
                </div>
                <div class="form-input">
                    <label for="">Departamento o área del desarrollo del proyecto en la empresa: </label>
                    <input type="text" name="txtDepto" id="txtDepto" required>
                </div>
                <br>
            
            <!-------------------------------------------------------------------------->
            <h3>Datos del asesor externo.</h3>
            <div class="form-input">
                <label for="">Nombre completo: </label >
                <input type="text" name="txtNombreAE" id="txtNombreAE" required>
            </div>
            <div class="form-input">
                <label for="">Puesto</label>
                <input type="text" name="txtPuesto" id="txtPuesto" required>
            </div>
            <div class="form-input">
                <label for="">Grado de estudios: </label>
                <select name="selectGrado" id="selectGrado" required>
                    <option value="Licenciatura">Licenciatura</option>
                    <option value="Maestría">Maestría</option>
                    <option value="Doctorado">Doctorado</option>
                    <option value="Otro">Otro</option>
                    <!--¿habilitar campo para introducir otro?-->
                </select>
                <label for="">Teléfono: </label>
                <input type="tel" name="txtTelAE" id="txtTelAE" required>
            </div>
            <div class="form-input">
                <label for="">Correo electrónico: </label>
                <input
                        type="text"
                        placeholder="correo@dominio.com"
                        name="emailView"
                        id="emailAE"
                        
                    />
            </div>
            <!-------------------------------------------------------------------------->
            
            <div>
                <h3>Horarios</h3>
                <label>Pulsa "+" para agregar un horario. En caso de equivocación, presiona "-" para eliminar el último horario ingresado.</label>
                <div id="contBotones">
                    <div class="button-add-del">
                        <input id="btnHorarios" class="primary-button" type="button" value="+">
                    </div>
                    <div class="button-add-del">
                        <input id="btnElimina" class="secondary-button" type="button" value="-">
                    </div>
                </div>
            </div>
            <div id="padre">

            </div>
            <br>
            
            
            <div class="button-container">
                <input id="subm" class="primary-button" type="button" value="TERMINAR">
            </div>

        </form>
    </div>
    <footer>
        <div class="sections-container">
            <section>
                <h2>Integrantes</h2>
                <div class="section-item">
                    <p>Daniel Hernández Sánchez</p>
                    <p><u>L17430048@piedrasnegras.tecnm.mx</u></p>
                </div>
                <div class="section-item">
                    <p>Roberto Carlos Díaz Sánchez</p>
                    <p><u>L17430057@piedrasnegras.tecnm.mx</u></p>
                </div>
            </section>
            <section>
                <h2>Materias</h2>
                <div class="section-item">
                    <p>Administración de Bases de Datos</p>
                    <p>SCB-1001</p>
                </div>
                <div class="section-item">
                    <p>Ingeniería de Software</p>
                    <p>SCD-1011</p>
                </div>
                <div class="section-item">
                    <p>Programación Web</p>
                    <p>AEB-1055</p>
                </div>
            </section>
            <section>
                <h2>Enlaces de interés</h2>
                <div class="section-item">
                    <p>
                        <a href="https://github.com/RobertoCDiaz/SIGER"
                            >Repositorio en GitHub</a
                        >
                    </p>
                    <p>
                        <a
                            href="https://piedrasnegrastecnm-my.sharepoint.com/personal/l17430048_piedrasnegras_tecnm_mx/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Fl17430048%5Fpiedrasnegras%5Ftecnm%5Fmx%2FDocuments%2FSIGER&ct=1584840570611&or=OWA-NT&cid=e859c527-8ba0-dede-716d-3772606a50e4&originalPath=aHR0cHM6Ly9waWVkcmFzbmVncmFzdGVjbm0tbXkuc2hhcmVwb2ludC5jb20vOmY6L2cvcGVyc29uYWwvbDE3NDMwMDQ4X3BpZWRyYXNuZWdyYXNfdGVjbm1fbXgvRXVYOUhKWktkM3BEbWZaZ1o0bkMxVmtCejlvODY1TVpqWFdJU3BYd0liNWZlQT9ydGltZT1mc3F4ZUFETzEwZw"
                            >Documentación y evidencias</a
                        >
                    </p>
                </div>
            </section>
        </div>
        <p>Instituto Tecnológico de Piedras Negras</p>
        <p>Ingeniería en Sistemas Computacionales</p>
    </footer>
    <!-- <script src="scripts/sidebar.js"></script> -->
    <script>
        let contadorHorarios = 0;

        function creaEtiquetas()
            {
                let contador = document.createElement('h3');
                contador.innerText='Horario '+contadorHorarios+'  ';
                contador.style.marginRight='0.8em';
                contador.style.opacity='0';
                let espacio = document.createElement('br');
                let contenedor = document.createElement('div');
                contenedor.style.display='flex';
                contenedor.style.flexDirection='row';
                contenedor.id='cont'+contadorHorarios;
                contenedor.style.margin='1em';

                let padre = document.getElementById('padre');
                padre.style.alignItems='center';
                padre.style.display='flex';
                padre.style.flexDirection='column';

                let caja1 = document.createElement('div');
                caja1.style.display='flex'
                caja1.style.flexDirection='row'
                let caja2 = document.createElement('div');
                caja2.style.display='flex'
                caja2.style.flexDirection='row'
                let entrada = document.createElement('h3');
                entrada.innerText='Entrada'
                entrada.style.marginLeft='0.7em';
                entrada.style.marginRight='0.7em';
                entrada.id='e'+contadorHorarios;
                let salida = document.createElement('h3');
                salida.innerText='Salida';
                salida.style.marginRight='1em';
                salida.style.marginLeft='1em';
                salida.id='s'+contadorHorarios;
                caja1.appendChild(entrada);
                caja2.appendChild(salida);
                contenedor.appendChild(contador);
                contenedor.appendChild(caja1);
                contenedor.appendChild(caja2);
                contenedor.appendChild(espacio);
                padre.appendChild(contenedor);
            }

        function creaHorarios()
            {
                contadorHorarios++;
                let contador = document.createElement('h3');
                contador.innerText='Horario '+contadorHorarios+'  ';
                contador.style.marginRight='1em';
                let espacio = document.createElement('br');
                let contenedor = document.createElement('div');
                contenedor.style.display='flex';
                contenedor.style.flexDirection='row';
                contenedor.id='cont'+contadorHorarios;
                contenedor.style.margin='1em';

                let padre = document.getElementById('padre');
                padre.style.alignItems='center';
                padre.style.display='flex';
                padre.style.flexDirection='column';

                let caja1 = document.createElement('div');
                caja1.style.display='flex'
                caja1.style.flexDirection='row'
                let caja2 = document.createElement('div');
                caja2.style.display='flex'
                caja2.style.flexDirection='row'
                let entrada = document.createElement('input');
                entrada.type='time';
                entrada.style.marginLeft='1em';
                entrada.style.marginRight='1em';
                entrada.id='e'+contadorHorarios;
                let salida = document.createElement('input');
                salida.type='time';
                salida.style.marginRight='1em';
                salida.style.marginLeft='1em';
                salida.id='s'+contadorHorarios;
                caja1.appendChild(entrada);
                caja2.appendChild(salida);
                contenedor.appendChild(contador);
                contenedor.appendChild(caja1);
                contenedor.appendChild(caja2);
                contenedor.appendChild(espacio);
                padre.appendChild(contenedor);
            }

            function eliminaHorario()
            {
                let cont = document.getElementById('cont'+contadorHorarios)
                if(contadorHorarios>1)
                {
                    let pa = cont.parentNode;
                    pa.removeChild(cont);
                    contadorHorarios--;
                }
            }

        const nombre_proyecto    = document.getElementById("txtNombreProyecto");
        const objetivo           = document.getElementById("txtObjetivo");
        const justificacion      = document.getElementById("txtJustificacion");
        const periodo            = document.getElementById("selectPeriodo");
        const ano                = document.getElementById("selectYear");
        const actividades        = document.getElementById("txtActividades");
        const fecha_elaboracion  = new Date().getTime();
        const empresa           = document.getElementById("txtEmpresa");
        const representante     = document.getElementById("txtRepresentante");
        const direccion         = document.getElementById("txtDireccion");
        const telEmpresa        = document.getElementById("txtTel");
        const ciudad            = document.getElementById("txtCiudad");
        const emailEmpresa      = document.getElementById("emailEmpresa");
        const depto             = document.getElementById("txtDepto");
        const nombreAE          = document.getElementById("txtNombreAE");
        const puesto            = document.getElementById("txtPuesto");
        const grado             = document.getElementById("selectGrado");
        const telAE             = document.getElementById("txtTelAE");
        const emailAE           = document.getElementById("emailAE");

        const subm              = document.getElementById("subm");

        subm.onclick=()=>{
            let entradas = [];
            let salidas = [];

            let parent = document.getElementById('padre');
            let c = document.getElementById('padre').children;

            for (let i = 1; i < c.length; i++) {
                let ch = c[i].children;
                for (let j = 0; j < ch.length; j++) {
                    let chi = ch[j].children;
                    for (let k = 0; k < chi.length; k++) {
                        if(j%2!=0)
                        {
                            let pe = String(chi[k].value);
                            let pee = pe.substring(0,5);
                            entradas.push(pee);
                            console.log('Entrada: ' + pee);
                        }
                        else
                        {
                            let ps = String(chi[k].value);
                            let pss = ps.substring(0,5);
                            salidas.push(pss);
                            console.log('Salida: ' + pss);
                        }
                    }
                }
            }
            
            if(!salidas[0])
            {
                alert('Ingresa un horario de salida válido');
                return;
            }


            if(nombre_proyecto.value==""||objetivo.value==""||justificacion.value==""||periodo.value==""||
            ano.value==""||actividades.value==""||empresa.value==""||representante.value==""||direccion.value==""||
            telEmpresa.value==""||ciudad.value==""||emailEmpresa.value==""||depto.value==""||nombreAE.value==""||
            puesto.value==""||grado.value==""||telAE.value==""||emailAE.value==""||!entradas[0]||!salidas[0]){
                alert("Por favor, llene todos los campos.");
                return;
            }

            let xhr = new XMLHttpRequest();
            xhr.open('POST','/registro-residencia',true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

            xhr.onreadystatechange = () => {
                    if(xhr.readyState==4 && xhr.status==200){
                        
                        let response = JSON.parse(xhr.responseText);
                        
                        if (response.code < 0) {
                            alert(response['message']);
                            return;
                        }
                        if (response.code == 1) {
                            alert('Residencia creada con éxito.');
                            window.open('/home', '_self');
                        }
                    }
                };

            xhr.send(
                `nombre_proyecto=${encodeURI(nombre_proyecto.value)}&` +
                `objetivo=${encodeURI(objetivo.value)}&` +
                `justificacion=${encodeURI(justificacion.value)}&` +
                `periodo=${encodeURI(periodo.value)}&` +
                `ano=${encodeURI(ano.value)}&` +
                `fecha_elaboracion=${encodeURI(fecha_elaboracion)}&` +
                `actividades=${encodeURI(actividades.value)}&` +
                `empresa=${encodeURI(empresa.value)}&` +
                `representante=${encodeURI(representante.value)}&` +
                `direccion=${encodeURI(direccion.value)}&` +
                `telEmpresa=${encodeURI(telEmpresa.value)}&` +
                `ciudad=${encodeURI(ciudad.value)}&` +
                `emailEmpresa=${encodeURI(emailEmpresa.value)}&` +
                `depto=${encodeURI(depto.value)}&` +
                `nombreAE=${encodeURI(nombreAE.value)}&` +
                `puesto=${encodeURI(puesto.value)}&` +
                `grado=${encodeURI(grado.value)}&` +
                `telAE=${encodeURI(telAE.value)}&` +
                `emailAE=${encodeURI(emailAE.value)}&` +
                `entradas=${encodeURI(JSON.stringify(entradas))}&` +
                `salidas=${encodeURI(JSON.stringify(salidas))}&` +
                `counter=${encodeURI(contadorHorarios)}` 
            );
        };

        const fill = () => {
            nombre_proyecto.value = 'Proyecto nuevo';;
            objetivo.value = 'Llenar este formato.';
            justificacion.value = 'Crear una nueva residencia.';
            periodo.value = 1;
            ano.value = 2020;
            actividades.value = 'Crear una función fill() para llenar automáticamente esto.';
            empresa.value = 'ITPN';
            representante.value = 'Fulanito de Tal';
            direccion.value = 'S/N #510, col. Tecnológico.';
            telEmpresa.value = '8781265438';
            ciudad.value = 'Piedras Negras';
            emailEmpresa.value = 'itpn@piedrasnegras.tecnm.mx';
            depto.value = 'Sistemas y Computación'
            nombreAE.value = 'Fulanito de Tal'
            puesto.value = 'Jefe de todo'
            grado.value = 'Maestría'
            telAE.value = '8781593625';
            emailAE.value = 'fulanito.dt@piedrasnegras.tecnm.mx';
        };
    </script>
    <script src="scripts/menu.js"></script>
</body>
</html>