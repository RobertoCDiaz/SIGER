<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar sesión</title>
    <link rel="stylesheet" href="styles/global.css">
        <link rel="stylesheet" href="styles/forms.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="styles/login.css">
</head>
<body>
    <header class="header-extension">
        <div class="bar">
            <!-- <h1><a href="/home">SIGER</a></h1> -->
            <a href="/home" style="display: flex; flex-direction: row; align-items: center;">
                <img src="assets/images/siger-img.png" height="40px" alt="SIGER">
                <h1 style="margin-left: .5em;">SIGER</h1>
            </a>
            <h2>Login</h2>
        </div>
    </header>
    
        <div class="content">
            <form id="form">
                <div id="mainform">
                <h2 style="margin-bottom: 1em;">Iniciar sesión</h2>
                <br>
                <div>
                    <div class="form-input">
                        <label for="">Email: </label>
                        <input
                            type="text"
                            placeholder=""
                            name="email"
                            id="emailView"
                            pattern="(L[0-9]{2}430[0-9]{3}@piedrasnegras\.tecnm\.mx)|([A-z]+\.[A-z]+@piedrasnegras\.tecnm\.mx)" />
                    </div>
                    <div class="form-input">
                        <label for="">Contraseña: </label>
                        <input
                            type="password"
                            name="pass"
                            id="passView"/>
                    </div>
                </div>
                
                <br>
                <!-- <div id="maindiv">
                    <div class="divs">
                        <input type="radio" name="clase" id="res" value="Residente" checked>
                        <label for="res">Residente</label>
                    </div>
                    
                    <div class="divs">
                        <input type="radio" name="clase" id="doce" value="Docente">
                        <label for="doce">Docente</label>
                    </div>
                </div> -->
                <br>
                </div>
                <div class="button-container" id="bot" style="margin-top: 1em;">
                    <button type="button" id="submitButtonView" class="primary-button">Ingresar</button>
                </div>
                <div style="margin: .5em 0; display: flex; flex-direction: column; align-items: center;">
                    <a href="/nuevo-residente">Crear cuenta de residente</a>
                    <a href="/nuevo-docente">Crear cuenta de docente</a>
                </div>
            </form>
            
        </div>
        <footer>
            <div class="sections-container">
                <section>
                    <h2>Integrantes</h2>
                    <div class="section-item">
                        <p>Daniel Hernández Sánchez</p>
                        <p><u>L17430048@piedrasnegras.tecnm.mx</u></p>
                    </div>
                    <div class="section-item">
                        <p>Roberto Carlos Díaz Sánchez</p>
                        <p><u>L17430057@piedrasnegras.tecnm.mx</u></p>
                    </div>
                </section>
                <section>
                    <h2>Materias</h2>
                    <div class="section-item">
                        <p>Administración de Bases de Datos</p>
                        <p>M. A. y L. Hilda Patricia Beltrán Hernández</p>
                        <p>SCB-1001</p>
                    </div>
                    <div class="section-item">
                        <p>Ingeniería de Software</p>
                        <p>M. C. Flor de María Rivera Sánchez</p>
                        <p>SCD-1011</p>
                    </div>
                    <div class="section-item">
                        <p>Programación Web</p>
                        <p>Ing. Antonio Chávez Soto</p><p>AEB-1055</p>
                    </div>
                </section>
                <section>
                    <h2>Enlaces de interés</h2>
                    <div class="section-item">
                        <p>
                            <a href="https://github.com/RobertoCDiaz/SIGER"
                                >Repositorio en GitHub</a
                            >
                        </p>
                        <p>
                            <a
                                href="https://piedrasnegrastecnm-my.sharepoint.com/personal/l17430048_piedrasnegras_tecnm_mx/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Fl17430048%5Fpiedrasnegras%5Ftecnm%5Fmx%2FDocuments%2FSIGER&ct=1584840570611&or=OWA-NT&cid=e859c527-8ba0-dede-716d-3772606a50e4&originalPath=aHR0cHM6Ly9waWVkcmFzbmVncmFzdGVjbm0tbXkuc2hhcmVwb2ludC5jb20vOmY6L2cvcGVyc29uYWwvbDE3NDMwMDQ4X3BpZWRyYXNuZWdyYXNfdGVjbm1fbXgvRXVYOUhKWktkM3BEbWZaZ1o0bkMxVmtCejlvODY1TVpqWFdJU3BYd0liNWZlQT9ydGltZT1mc3F4ZUFETzEwZw"
                                >Documentación y evidencias</a
                            >
                        </p>
                    </div>
                </section>
            </div>
            <p>Instituto Tecnológico de Piedras Negras</p>
            <p>Ingeniería en Sistemas Computacionales</p>
        </footer>
        <script>
            const emailView = document.getElementById('emailView');
            const passView = document.getElementById('passView');
            const submitButton = document.getElementById('submitButtonView');
            submitButton.onclick = () =>{
                if(
                    emailView.value.trim() == "" ||
                    passView.value == ""
                ){
                    alert("Por favor, llene todos los campos.");
                    return;
                }

                let userClass;

                // TODO: Eliminar esto y hacer apropiadamente el login de docentes.
                // if (
                //     emailView.value.trim() == 'roberto.ds@piedrasnegras.tecnm.mx' ||
                //     emailView.value.trim() == 'daniel.hs@piedrasnegras.tecnm.mx'
                // ) {
                //     userClass = 2;
                /*} else */if (new RegExp('L[0-9]{8}@piedrasnegras\.tecnm\.mx').test(emailView.value.trim())) {
                    userClass = 1;
                } else if (new RegExp('[A-z]+\.[A-z]{2}@piedrasnegras\.tecnm\.mx').test(emailView.value.trim())) {
                    userClass = 2;
                }


                let xhr = new XMLHttpRequest();
                xhr.open('POST','/auth',true);
                xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                
                xhr.onreadystatechange = () => {
                    if(xhr.readyState==4 && xhr.status==200){
                        const response = JSON.parse(xhr.responseText);

                        if (response.code < 0) {
                            alert(response['message']);
                            return;
                        }

                        if (response.code == 1) {
                            window.open('/home', '_self');
                            return;
                        }
                    }
                };
                xhr.send(
                    `email=${encodeURI(emailView.value.trim())}&` +
                    `pass=${encodeURI(passView.value)}&` +
                    `class=${encodeURI(userClass)}`
                );
            };
        </script>
</body>
</html>