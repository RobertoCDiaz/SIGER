<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anexar carta de aceptación :: SIGER</title>
    <link rel="stylesheet" href="/styles/global.css">
    <link rel="stylesheet" href="/styles/forms.css">
    <link rel="stylesheet" href="/residentes/nueva-carta-aceptacion.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    
    <header class="header-extension">
        <div class="bar">
            <!-- <h1><a href="/home">SIGER</a></h1> -->
            <a href="/home" style="display: flex; flex-direction: row; align-items: center;">
                <img src="/assets/images/siger-img.png" height="40px" alt="SIGER">
                <h1 style="margin-left: .5em;">SIGER</h1>
            </a>
            <h2>Subir carta de aceptación</h2>
        </div>
    </header>


    <div class="content">
        <form action="/anexarCartaAceptacion" method="POST" enctype="multipart/form-data">
            <p>La Carta de Aceptación es ese documento dado en la empresa que certifica que un residente ha sido aceptado para realizar su residencia profesional.</p>
            <br>
            <p>Para registrar su carta de aceptación en el SIGER, por favor tome una foto o escanee el documento dado por la empresa y súbalo a continuación.
            </p>
            <div id="uploader">
                <i class="material-icons">publish</i>
                <p id="fileNameView">Haga click aquí para seleccionar un archivo...</p>
            </div>
            <input id="fileInputView" type="file" hidden>
            <div class="buttons">
                <button id="goBackButton" type="button" class="secondary-button">VOLVER AL MENÚ</button>
                <button id="uploadButton" type="button" class="primary-button">SUBIR CARTA DE ACEPTACIÓN</button>
            </div>
        </form>
    </div>

    <script>
        const uploader = document.querySelector('#uploader');
        const fileInputView = document.querySelector('#fileInputView');
        const fileNameView = document.querySelector('#fileNameView');
        const goBackButton = document.querySelector('#goBackButton');
        const uploadButton = document.querySelector('#uploadButton');

        uploader.onclick = () => fileInputView.click();

        const anexar = (file) => new Promise((resolve, reject) => {
            let xhr = new XMLHttpRequest();
            xhr.open('post', `/anexarCartaAceptacion`, true);
            // xhr.setRequestHeader('Content-type', 'application/binary');

            let postData = new FormData();
            postData.append('newfile', file);
            
            xhr.onload = () => {
                const response = JSON.parse(xhr.response);

                if (response['code'] != 1) {
                    reject(response['message']);
                    return;
                }
                
                resolve(response['object']);
            };
            
            xhr.send(postData);
        });

        let img;
        fileInputView.onchange = () => {
            if (!/image\/[A-z]+/.test(fileInputView.files[0].type)) {
                alert('Solo se admiten archivos de imagen');
                return;
            }

            img = fileInputView.files[0];
            fileNameView.innerHTML = img.name;
        }

        uploadButton.onclick = () => {
            if (!img) {
                alert('Por favor, seleccione una fotografía de su carta de aceptación')
                return;
            }

            anexar(img).then(obj => {
                alert("Se ha subido la carta de aceptación con éxito");
                window.open('/home', '_self');
            }).catch(error => {
                alert(error);
            });
        }
    </script>

    <footer>
        <div class="sections-container">
        <section>
            <h2>Integrantes</h2>
            <div class="section-item">
                <p>Daniel Hernández Sánchez</p>
                <p><u>L17430048@piedrasnegras.tecnm.mx</u></p>
            </div>
            <div class="section-item">
                <p>Roberto Carlos Díaz Sánchez</p>
                <p><u>L17430057@piedrasnegras.tecnm.mx</u></p>
            </div>
        </section>
        <section>
            <h2>Materias</h2>
            <div class="section-item">
                <p>Administración de Bases de Datos</p>
                <p>SCB-1001</p>
            </div>
            <div class="section-item">
                <p>Ingeniería de Software</p>
                <p>SCD-1011</p>
            </div>
            <div class="section-item">
                <p>Programación Web</p>
                <p>AEB-1055</p>
            </div>
        </section>
        <section>
            <h2>Enlaces de interés</h2>
            <div class="section-item">
                <p><a href="https://github.com/RobertoCDiaz/SIGER">Repositorio en GitHub</a></p>
                <p><a href="https://piedrasnegrastecnm-my.sharepoint.com/personal/l17430048_piedrasnegras_tecnm_mx/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Fl17430048%5Fpiedrasnegras%5Ftecnm%5Fmx%2FDocuments%2FSIGER&ct=1584840570611&or=OWA-NT&cid=e859c527-8ba0-dede-716d-3772606a50e4&originalPath=aHR0cHM6Ly9waWVkcmFzbmVncmFzdGVjbm0tbXkuc2hhcmVwb2ludC5jb20vOmY6L2cvcGVyc29uYWwvbDE3NDMwMDQ4X3BpZWRyYXNuZWdyYXNfdGVjbm1fbXgvRXVYOUhKWktkM3BEbWZaZ1o0bkMxVmtCejlvODY1TVpqWFdJU3BYd0liNWZlQT9ydGltZT1mc3F4ZUFETzEwZw">
                    Documentación y evidencias
                </a></p>
            </div>
        </section>
        </div>
        <p>Instituto Tecnológico de Piedras Negras</p>
        <p>Ingeniería en Sistemas Computacionales</p>
    </footer>

</body>
</html>